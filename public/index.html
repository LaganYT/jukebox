	<html lang="en" ng-app="jukebox" ng-controller="MainCtrl">
	<head>
		<title ng-bind="queue.nowPlaying.streamUrl ? (queue.tracks[queue.nowPlaying.index].name + ' - ' + queue.tracks[queue.nowPlaying.index].artists[0].name) : 'Jukebox Redux'">
			Jukebox Redux
		</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" type="text/css" href="css/style.css"/>
		<link rel="stylesheet" type="text/css" href="https://ajax.googleapis.com/ajax/libs/angular_material/1.1.0/angular-material.min.css">
		<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,400italic">
		<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/icon?family=Material+Icons">
		<style>
			.track {
				margin: 5px;
			}
			.track-desc {
				padding-left: 10px;
				padding-top: 12px;
			}
			.track-desc p {
				margin: 0; padding: 0;
			}
			
			.playerBar {
				width: 100%;
			}
			.playerBar > md-card {
				margin-bottom: 0;
			}
			
			.autocomplete-custom-template .track, .autocomplete-custom-template .artist {
				padding: 0;
				margin: 0;
			}
			
			.margin-0 {
				margin: 0 !important;
			}
			
			.padding-sides {
				padding: 0px 16px;
			}
			
			.md-avatar.no-mask {
				border-radius: 0 !important;
			}
			
			.md-avatar {
				width: 40px;
				height: 40px;
				border-radius: 50%;
			}
			.md-avatar.large {
				width: 60px;
				height: 60px;
			}
			
			.scroll-container {
				overflow-y: scroll;
			}
			
		</style>
	</head>
	<body ng-cloak layout="column" layout-align="start stretch">
		
		<audio
			id="song"
			ng-src="{{Player.queue.nowPlaying.streamUrl}}">
		</audio>

		<md-toolbar class="md-hue-2" md-whiteframe="3dp">
			<form ng-submit="search(searchText)" class="margin-0">
				<div class="md-toolbar-tools" layout="row" layout-align="space-between center">
					<h2 flex="10" md-truncate>Jukebox</h2>
					
					<p>Latency: {{Player.latency}}</p>
					
					<md-autocomplete
						flex="40"
						ng-disabled="isDisabled"
						md-items="track in loadSuggestions(searchText)"
						md-item-text="track.name"
						md-no-cache="noCache"
						md-selected-item="selectedItem"
						md-search-text="searchText"
						md-selected-item-change="playTrack(track)"
						md-min-length="0"
						md-delay="100"
						md-menu-class="search-suggestion"
						placeholder="Search a song, artist, or album">
						
						<md-item-template ng-click="Player.playTrack(track)">
							<span class="track" md-highlight-text="ctrl.searchText" md-highlight-flags="^i">{{track.name}}</span>
							<br/>
							<span class="artist" md-highlight-text="ctrl.searchText" md-highlight-flags="^i">{{track.artists[0].name}}</span>
						</md-item-template>
						
						<md-not-found>
							Sorry, we couldn't find <strong>{{searchText}}</strong>
						</md-not-found>
					</md-autocomplete>
					
					<span flex="10"></span>
				</div>
			</form>
	    </md-toolbar>
		
		<div layout="row" flex>
			<div layout="row" layout-align="space-around stretch" flex ng-show="searchResults">
				<div flex ng-repeat="section in ['albums', 'artists', 'playlists']"  class="scroll-container">
					<md-list flex>
						<md-subheader class="md-no-sticky">{{section | capitalize}}</md-subheader>
						
						<md-list-item class="md-2-line" ng-repeat="item in searchResults[section]" ng-click="setQueue(section, $index, item)">
							<img ng-src="{{item.images[0].url}}" class="md-avatar no-mask" alt="{{todos[0].who}}"/>
							
							<div class="md-list-item-text">
								<h3>{{item.name}}</h3>
								<p>{{item.artists[0].name || item.owner.id}}</p>
							</div>
						</md-list-item>
					</md-list>
				</div>
			</div>
			
			<div flex="30" ng-show="Player.queue.source" class="padding-sides scroll-container" md-whiteframe="4dp" style="z-index: 1;">
				<p class="md-body-2">Now Playing</p>
				
				<div layout="row">
					<img ng-src="{{Player.queue.source.images[0].url}}" class="md-avatar large no-mask"/>
					
					<div layout="column" style="margin: 5px 15px;">
						<p class="md-title margin-0">{{Player.queue.source.name}}</p>
						<p class="md-subhead margin-0">{{Player.queue.source.artists[0].name || Player.queue.source.owner.id}}</p>
					</div>
				</div>
				
				<md-list>
					<md-list-item class="md-2-line" ng-repeat="track in Player.queue.tracks" ng-click="Player.playTrackFromIndex($index)">
						<img
							ng-src="{{Player.queue.nowPlaying.index == $index ? 'http://i.imgur.com/zKQ3N8e.gif' : (track.album.images[0].url || Player.queue.source.images[0].url)}}"
							class="md-avatar no-mask"
							alt="{{track.name}}"/>
						
						<div class="md-list-item-text">
							<h3>{{track.name}}</h3>
							<p>{{track.artists[0].name}}</p>
						</div>
					</md-list-item>
				</md-list>
			</div>
		</div>
		
		<div layout="row" layout-align="center start">
			<md-card
				class="player md-whiteframe-4dp"
				flex="100"
				style="height: 100px;"
				layout="row"
				ng-style="{'background-color': (Player.queue.nowPlaying.swatches.Vibrant | vibrantRgb)}">
		
				<img ng-src="{{Player.queue.tracks[Player.queue.nowPlaying.index].album.images[0].url}}" vibrant ng-model="Player.queue.nowPlaying.swatches" crossOrigin="anonymous" style="width: 100px;"/>
				
				<div layout="column" flex>
					<seek-bar audio="Player.el"></seek-bar>
					
					<div class="controls" layout="row" layout-align="space-between center" flex>
						<div class="left md-padding">
							<p class="title md-body-2">{{Player.queue.tracks[Player.queue.nowPlaying.index].name}}</p>
							<p class="detail md-caption">
								<a ui-sref="artist({artistID: nowPlaying.track.artists[0].id})">{{Player.queue.tracks[Player.queue.nowPlaying.index].artists[0].name}}</a>
								-
								<a ui-sref="album({albumID: nowPlaying.track.album.id})">{{Player.queue.source.name}}</a>
							</p>
						</div>
						
						<div class="center">
							<md-button class="md-icon-button" aria-label="Loop song">
								<md-icon class="material-icons">loop</md-icon>
							</md-button>
							
							<md-button class="md-icon-button" aria-label="Skip previous">
								<md-icon class="material-icons">skip_previous</md-icon>
							</md-button>
							
							<md-button class="md-icon-button" aria-label="Play/Pause" ng-click="Player.plause()">
								<md-icon class="material-icons">{{Player.el.paused ? 'play_arrow' : 'pause'}}</md-icon>
							</md-button>
							
							<md-button class="md-icon-button" aria-label="Skip next">
								<md-icon class="material-icons">skip_next</md-icon>
							</md-button>
							
							<md-button class="md-icon-button" aria-label="Shuffle">
								<md-icon class="material-icons">shuffle</md-icon>
							</md-button>
						</div>
						
						<div class="right">
							<md-button class="md-icon-button" aria-label="Open Lyrics" ng-click="openLyrics($event)">
								<md-icon class="material-icons">music_note</md-icon>
							</md-button>
						</div>
					</div>
				</div>
			</md-card>
		</div>
		
		<!-- Angular Material requires Angular.js Libraries -->
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular.js"></script>
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-animate.min.js"></script>
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-aria.min.js"></script>
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-messages.min.js"></script>

		<!-- Angular Material Library -->
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angular_material/1.1.0/angular-material.min.js"></script>
		
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.1/socket.io.js"></script> <!-- Socket.io -->
		<script type="text/javascript" src="https://cdn.rawgit.com/btford/angular-socket-io/master/socket.js"></script> <!-- Angular Socket.io -->
		<script type="text/javascript" src="https://cdn.rawgit.com/jariz/vibrant.js/master/dist/Vibrant.js"></script>
		<script type="text/javascript" src="https://cdn.rawgit.com/maxjoehnk/ngVibrant/fd9c068d/dist/angular-vibrant.js"></script>

		<!-- Your application bootstrap  -->
		<script type="text/javascript">
			/* global angular */
			var app = angular.module('jukebox', ['ngMaterial', 'btford.socket-io', 'ngVibrant']);

			app.controller('MainCtrl', ['$scope', '$rootScope', '$http', '$location', '$mdMenu', '$mdDialog', '$mdToast', 'Socket', 'Player',
				function($scope, $rootScope, $http, $location, $mdMenu, $mdDialog, $mdToast, Socket, Player) {
					
				$scope.$location = $location;
				$scope.$mdMenu = $mdMenu;
				$scope.Player = Player;
				
				$scope.setQueue = function(dataType, i, source) {
					Socket.emit('queue:set', {
						source: source,
						nowPlaying: {
							index: i,
							progress: 0
						}
					});
				};
				
				$scope.openLyrics = function(event) {
					Socket.emit('lyrics:open', {event: event});
					
					var track = Player.queue.tracks[Player.queue.nowPlaying.index];
					$http.get('/api/tracks/lyrics?track_id='+ track.id).then(function(response) {
						$mdDialog.show({
							parent: angular.element(document.body),
							targetEvent: event,
							templateUrl: '/views/lyrics/lyrics.html',
							locals: {
								
							},
							controller: ['$scope', function($scope) {
								$scope.track = response.data;
							}],
							clickOutsideToClose: true
						});
					});
				};
				
				$scope.search = function(query, limit, offset) {
					$http({
						url: '/api/search',
						method: 'GET',
						params: {
							q: query,
							limit: limit,
							offset: offset
						}
					}).then(function(response) {
						$scope.searchResults = {
							albums: response.data.albums.items,
							artists: response.data.artists.items,
							playlists: response.data.playlists.items
						};
					});
				};
				
				$scope.loadSuggestions = function(query) {
					return $http.get('/api/tracks/search?q='+ query)
						.then(function(response) {
							return response.data.body.tracks.items;
						});
				};
			}]);
		</script>
		
		<script type="text/javascript" src="components/seekbar/seekbar.directive.js"></script>
		
		<script type="text/javascript" src="components/socket/socket.factory.js"></script>
		
		<script type="text/javascript" src="components/player/player.service.js"></script>
		
		<script type="text/javascript" src="filters/capitalize.filter.js"></script>
		<script type="text/javascript" src="filters/seconds-time.filter.js"></script>
		<script type="text/javascript" src="filters/vibrant-rgb.filter.js"></script>
		
	</body>
	</html>